# Сервис синхронизации файлов

Сервис для двунаправленной синхронизации файлов с настраиваемой конфигурацией. Позволяет синхронизировать файлы с разными именами, находящиеся в разных директориях.

## Возможности

- Двунаправленная синхронизация файлов
- Поддержка файлов с разными именами
- Настраиваемые базовые директории через переменные окружения
- Гибкая конфигурация через YAML-файл
- Поддержка фильтрации файлов и директорий с помощью chokidar
- Веб-интерфейс для мониторинга и управления
- Система логирования с сохранением в файл

## Установка

1. Клонируйте репозиторий
2. Установите зависимости:
   ```
   npm install
   ```
3. Создайте файл `.env` на основе `.env.example`:
   ```
   cp .env.example .env
   ```
4. Настройте базовые директории в файле `.env`
5. Настройте пары файлов для синхронизации в `config.yaml`

## Конфигурация

### Переменные окружения (.env)

```
# Базовые директории для синхронизации
BASE_DIR_1=C:/путь/к/первой/директории
BASE_DIR_2=C:/путь/к/второй/директории
BASE_DIR_3=C:/путь/к/третьей/директории

# Путь к конфигурационному файлу
CONFIG_PATH=./config.yaml

# Настройки для chokidar
STABILITY_THRESHOLD=2000
POLL_INTERVAL=100
USE_POLLING=false

# Порт для веб-интерфейса
PORT=3003
```

### Конфигурация синхронизации (config.yaml)

```yaml
# Конфигурация синхронизации файлов

# Базовые директории (можно переопределить через переменные окружения)
baseDirs:
  dir1: ${BASE_DIR_1}
  dir2: ${BASE_DIR_2}
  dir3: ${BASE_DIR_3}

# Настройки chokidar
watchOptions:
  # Игнорировать скрытые файлы и директории
  ignored: 
    - "**/.git/**"
    - "**/node_modules/**"
    - "**/.DS_Store"
  # Ждать завершения записи файла
  awaitWriteFinish:
    stabilityThreshold: ${STABILITY_THRESHOLD}
    pollInterval: ${POLL_INTERVAL}
  # Использовать режим опроса (полезно для сетевых дисков)
  usePolling: ${USE_POLLING}
  # Не генерировать события при запуске для существующих файлов
  ignoreInitial: true
  # Не завершать процесс пока активно наблюдение
  persistent: true

# Пары файлов для синхронизации
syncPairs:
  - name: "Документ 1" # Опциональное имя для логирования
    source:
      baseDir: dir1
      path: file1.md
    target:
      baseDir: dir2
      path: file2.md
  
  - name: "Документ 2"
    source:
      baseDir: dir1
      path: file11.md
    target:
      baseDir: dir2
      path: file11.md
```

## Запуск

```
npm start
```

Или с указанием пути к конфигурационному файлу:

```
node server.js /путь/к/config.yaml
```

## Веб-интерфейс

После запуска сервера веб-интерфейс доступен по адресу:

```
http://localhost:3003
```

Веб-интерфейс предоставляет следующие возможности:
- Мониторинг статуса сервера (запущен/остановлен)
- Просмотр списка синхронизируемых файлов
- Отслеживание времени последней синхронизации
- Просмотр логов сервера в реальном времени
- Управление сервером (запуск/остановка/перезапуск) с автоматическим перечитыванием конфигурации

## Как это работает

1. Сервис загружает конфигурацию из YAML-файла и переменных окружения
2. При запуске или перезапуске через веб-интерфейс конфигурация перечитывается автоматически
3. Для каждой пары файлов создаются наблюдатели chokidar
3. При изменении файла в одной директории, изменения автоматически применяются к соответствующему файлу в другой директории
4. Поддерживается двунаправленная синхронизация (изменения в любом из файлов пары синхронизируются)
5. Предотвращаются циклические обновления с помощью дебаунсинга и отслеживания операций
6. Все операции логируются в консоль и файл
7. Веб-интерфейс обновляется в реальном времени через WebSocket

## Система логирования

Логи сохраняются в директорию `logs` в формате `sync-YYYY-MM-DD.log`. Доступны следующие уровни логирования:

- DEBUG - детальная отладочная информация
- INFO - информационные сообщения (по умолчанию)
- WARN - предупреждения
- ERROR - ошибки

## Зависимости

- chokidar - для отслеживания изменений файлов
- fs-extra - для расширенных операций с файлами
- js-yaml - для парсинга YAML-конфигурации
- dotenv - для загрузки переменных окружения
- lodash - для утилит (debounce, template)
- express - для веб-сервера
- socket.io - для WebSocket коммуникации